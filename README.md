# X-Function(アウトプット確認用サンプル)

本リポジトリは個人的に開発しているUnity製ゲーム「X-Function」のプロジェクトから、有料アセットなどを取り除いたものです。

プロジェクトとしては不完全な状態なので動作させることはできません。コードの内容の確認などにご活用ください。

## 内容についての説明

### ゲームの概要

開発環境：Unity
使用言語：C#
対象プラットフォーム：PC、スマートフォン
制作人数：1人
担当範囲：全て
制作期間：約7年（開発中）

本ゲームはゲーム内でロボットをプログラムし、戦闘させる3Dプログラミングアクションゲームです。

カルネージハートシリーズのようなゲーム、と言えば分かる方は分かりやすいかもしれません…。

ノードエディタを使用してかなり高度なプログラムを書くことができ、アクションの自由度と高速性が合わさって人がコントローラで操作する場合では難しいハイスピードな戦闘を楽しむことができます。

現在開発中であり、2025年の速い段階でクローズドで体験版をリリースする予定です。

### 普段のリポジトリ使用状況について

普段の開発はGitlab上のリポジトリを使用して開発しています。

Gitlabを使用しているのは単純に使用できる容量が大きく経済的であるためです。

### 作成物用フォルダ

Assets/DevFilesがプロジェクトの主要な作成物を格納するファイルです。

Assetsフォルダには他所から導入したアセットの内容が無秩序に配置されてしまうので個別のフォルダを用意しています。

### スクリプトフォルダ構造説明

各フォルダにどのようなスクリプトがあるかをおおまかに記載します。

##### Assets/DevFiles/Scripts/Action

アクション画面関係

##### Assets/DevFiles/Scripts/Bases

共通部分

##### Assets/DevFiles/Scripts/Extensions

単機能スクリプト系

##### Assets/DevFiles/Scripts/HUB

ゲーム内で使用するアセットやデータを管理するデータベース関連

##### Assets/DevFiles/Scripts/I2Languages

有料アセット「I2Localization」でベイクした翻訳関連

##### Assets/DevFiles/Scripts/Initialize

オープニング画面関連

##### Assets/DevFiles/Scripts/Menu

メニュー画面関連

##### Assets/DevFiles/Scripts/PGE

ゲーム内でプログラミングするためのノードエディタ関連

##### Assets/DevFiles/Scripts/Programs

ゲーム内プログラム関連

##### Assets/DevFiles/Scripts/Save

セーブ関連

##### Assets/DevFiles/Scripts/Settings

UI設定関連（現在使用していない）

### 技術的に特筆すべき点

かなり膨大な内容なので、技術的に特筆すべきと思う点についてかいつまんで説明します。

##### オブジェクトサーチ関連

Assets/DevFiles/Scripts/Action/ObjectSearch以下のスクリプトでは、範囲探索処理を独自に実装しています。

本ゲームでは大量の敵や弾、設置物をプレイヤーがプログラムを通して必要なものだけサーチし、的確な動作を行えるようにする必要があります。
しかも、これは60FPSで毎フレーム、敵味方複数の機体が参加した分行える必要があります。
この用途に対し、Unityの物理エンジンにある範囲探索処理では性能が不足していました。
そのため、高速で3次元空間をサーチできる処理を自作しました。
自作の範囲探索処理には以下の工夫を行いました。

- 単純に処理量を減らすため、コライダーではなく座標で処理を行うようにした。
- ボックス型、シリンダ型、球形を加工した複雑な形状のサーチ範囲を設定でき、さらにこの中から条件を満たすオブジェクトをソートして取得することができるようにした。
- 高速化のため、モートンオーダーを使用して空間分割を行い、最小限の処理を行うようにした。モートンオーダーの実装は英語の論文を参考に自力で行いました。
- 条件マッチング処理の順序を工夫し、敵味方の判定やこちらに向かっているかなどの軽い処理を範囲内であるかの処理より先に行うことで軽量化を目指した。

また、これを用いた範囲探索の範囲をプレイヤーにわかりやすく表示するため、プログラムエディタではワイヤーフレーム状の描画を行なっています。

##### 移動処理

本作ではロボットが地上を移動する処理についてかなり力を注いでいます。

このゲームではユーザーがプログラムして動かすものなので、初心者でも動かしやすいようにロボットは障害物を登って乗り越えることができるように実装しています。もちろん、登っている途中の足の動きやジャンプなども自然に行えるようにしています。

以下のスクリプトではそれぞれ機体の動きやそれに伴う足の動きを制御しています。（この辺のクラスの構造はあまり良くないのでそのうちリファクタリングしたいところ）

Assets/DevFiles/Scripts/Action/Machines/MachineMovePar.cs
Assets/DevFiles/Scripts/Action/Machines/Motion/LegMover.cs

##### ゲーム内プログラミング

X以下ではノードエディタ関係を、X以下ではそこで扱われるデータ内容を扱っています。
ノードは40種類以上あり、それぞれ全く異なるパラメータを持っていて全て編集できるようになっていますが、PgbepManagerクラスの各SetPgbep〜メソッドを使用することで比較的簡単に表示内容を制御、値の設定などをできるようにしています。
